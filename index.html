<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowCrypt - Pixel Art Dark Fantasy</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        :root {
            /* Cores Pixel Art Dark Fantasy */
            --dark-bg: #0a0a0f;
            --darker-bg: #050508;
            --accent-red: #8b0000;
            --accent-gold: #daa520;
            --accent-silver: #c0c0c0;
            --text-light: #e8e8e8;
            --text-dim: #a0a0a0;
            --border-dark: #1a1a2e;
            --border-light: #2d2d4d;
            
            /* Cores de raridade */
            --common: #969696;
            --uncommon: #2ecc71;
            --rare: #3498db;
            --epic: #9b59b6;
            --legendary: #f1c40f;
            
            /* Tamanhos pixelados */
            --pixel-size: 2px;
            --border-pixel: 2px solid;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: #0a0a0f;
            color: var(--text-light);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            position: relative;
            width: 1200px;
            height: 700px;
            display: flex;
            background: var(--darker-bg);
            border: var(--border-pixel) var(--accent-red);
            overflow: hidden;
        }

        .game-area {
            flex: 3;
            position: relative;
            overflow: hidden;
            background: #0a0a0f;
        }

        #game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* UI Pixel Art */
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .health-bar, .mana-bar {
            position: absolute;
            left: 20px;
            background: #000;
            border: var(--border-pixel) #400;
            overflow: hidden;
        }

        .health-bar {
            top: 20px;
            width: 200px;
            height: 16px;
        }

        .mana-bar {
            top: 45px;
            width: 200px;
            height: 12px;
            border-color: #006;
        }

        .health-fill, .mana-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .health-fill { background: #8b0000; }
        .mana-fill { background: #1e90ff; }

        .player-stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 8px 12px;
            border: var(--border-pixel) var(--border-light);
            font-size: 8px;
        }

        .stat-value {
            color: var(--accent-gold);
        }

        .floor-indicator {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 8px 12px;
            border: var(--border-pixel) var(--border-light);
            font-size: 8px;
        }

        /* Mini Map Pixel Art */
        .mini-map {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 120px;
            height: 120px;
            background: rgba(0, 0, 0, 0.9);
            border: var(--border-pixel) var(--accent-gold);
            padding: 5px;
        }

        .mini-map-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 1px;
            width: 100%;
            height: 100%;
        }

        .mini-map-room {
            background: #2a2a3a;
            border: 1px solid #444;
            font-size: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .mini-map-room.current { background: #8b0000; }
        .mini-map-room.visited { background: #4a4a6a; }
        .mini-map-room.stairs { background: #daa520; }
        .mini-map-room.merchant { background: #32cd32; }
        .mini-map-room.boss { background: #dc143c; }

        /* Sidebar Pixel Art */
        .sidebar {
            flex: 1;
            background: rgba(10, 10, 20, 0.95);
            border-left: var(--border-pixel) var(--border-dark);
            padding: 10px;
            overflow-y: auto;
        }

        .inventory, .skills, .quest-log, .equipment {
            margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.7);
            border: var(--border-pixel) var(--border-dark);
            padding: 10px;
        }

        .section-title {
            color: var(--accent-gold);
            border-bottom: var(--border-pixel) var(--border-light);
            padding-bottom: 5px;
            margin-bottom: 8px;
            font-size: 10px;
            text-align: center;
        }

        .inventory-slots {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }

        .inventory-slot {
            width: 40px;
            height: 40px;
            background: #2a2a3a;
            border: var(--border-pixel) var(--border-light);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            cursor: pointer;
            position: relative;
        }

        .inventory-slot:hover::after {
            content: 'X';
            position: absolute;
            top: -5px;
            right: -5px;
            background: #8b0000;
            color: white;
            width: 12px;
            height: 12px;
            font-size: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid white;
        }

        .equipment-slots {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
        }

        .equipment-slot {
            background: #2a2a3a;
            border: var(--border-pixel) var(--border-light);
            padding: 5px;
            text-align: center;
            min-height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 8px;
        }

        /* Screens */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(10, 10, 15, 0.95);
            z-index: 100;
        }

        .title {
            font-size: 24px;
            color: var(--accent-gold);
            margin-bottom: 20px;
            text-align: center;
        }

        .subtitle {
            font-size: 10px;
            color: var(--text-dim);
            margin-bottom: 30px;
            text-align: center;
            max-width: 600px;
            line-height: 1.5;
        }

        .btn {
            background: #2a2a3a;
            color: var(--text-light);
            border: var(--border-pixel) var(--border-light);
            padding: 10px 20px;
            margin: 5px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            cursor: pointer;
        }

        .btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .btn-primary {
            background: #8b0000;
            border-color: var(--accent-red);
        }

        /* Scrollbar Pixel */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a2e;
        }

        ::-webkit-scrollbar-thumb {
            background: #8b0000;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-area">
            <canvas id="game-canvas" width="900" height="700"></canvas>
            
            <div class="ui-overlay">
                <div class="health-bar">
                    <div class="health-fill" id="health-fill"></div>
                </div>
                <div class="mana-bar">
                    <div class="mana-fill" id="mana-fill"></div>
                </div>
                
                <div class="player-stats">
                    <div>NVL: <span class="stat-value" id="player-level">1</span></div>
                    <div>DMG: <span class="stat-value" id="player-damage">10-15</span></div>
                    <div>DEF: <span class="stat-value" id="player-defense">5</span></div>
                    <div>GOLD: <span class="stat-value" id="player-gold">0</span></div>
                </div>
                
                <div class="floor-indicator">
                    FLOOR: <span id="floor-number">1</span> ROOM: <span id="room-number">1</span>
                </div>
                
                <div class="mini-map">
                    <div class="mini-map-grid" id="mini-map"></div>
                </div>
            </div>
        </div>
        
        <div class="sidebar">
            <div class="equipment">
                <div class="section-title">EQUIP</div>
                <div class="equipment-slots">
                    <div class="equipment-slot" data-slot="weapon">
                        <div>WEAPON</div>
                        <div id="equipped-weapon">-</div>
                    </div>
                    <div class="equipment-slot" data-slot="armor">
                        <div>ARMOR</div>
                        <div id="equipped-armor">-</div>
                    </div>
                    <div class="equipment-slot" data-slot="helmet">
                        <div>HELMET</div>
                        <div id="equipped-helmet">-</div>
                    </div>
                    <div class="equipment-slot" data-slot="boots">
                        <div>BOOTS</div>
                        <div id="equipped-boots">-</div>
                    </div>
                    <div class="equipment-slot" data-slot="ring">
                        <div>RING</div>
                        <div id="equipped-ring">-</div>
                    </div>
                    <div class="equipment-slot" data-slot="amulet">
                        <div>AMULET</div>
                        <div id="equipped-amulet">-</div>
                    </div>
                </div>
            </div>
            
            <div class="inventory">
                <div class="section-title">INVENTORY</div>
                <div class="inventory-slots" id="inventory-slots"></div>
            </div>
        </div>
        
        <!-- Start Screen -->
        <div class="screen start-screen">
            <div class="title">SHADOWCRYPT</div>
            <div class="subtitle">A PIXEL ART DARK FANTASY DUNGEON CRAWLER</div>
            <button class="btn btn-primary" id="start-btn">START QUEST</button>
        </div>
        
        <!-- Game Over Screen -->
        <div class="screen game-over" style="display: none;">
            <div class="title">GAME OVER</div>
            <div class="subtitle">YOUR JOURNEY ENDS IN THE DEPTHS...</div>
            <div id="game-over-stats" style="margin-bottom: 20px; text-align: center; font-size: 8px;"></div>
            <button class="btn btn-primary" id="restart-btn">TRY AGAIN</button>
        </div>
    </div>

    <script>
        // =============================================
        // PIXEL ART GAME ENGINE
        // =============================================
        
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        
        // Game state
        let gameState = 'menu';
        let player = {};
        let currentFloor = 1;
        let currentRoom = 13;
        let rooms = [];
        let enemies = [];
        let items = [];
        let projectiles = [];
        let particles = [];
        let combatTexts = [];
        let roomCleared = false;
        let visitedRooms = new Set();
        let stairsLocation = null;
        let merchantRoom = null;
        
        // Pixel Art Sprites (simplificados)
        const sprites = {
            player: {
                body: [
                    [0,1,1,1,0],
                    [1,2,2,2,1],
                    [1,2,2,2,1],
                    [0,1,1,1,0],
                    [0,1,0,1,0]
                ],
                colors: ['#000000', '#4a4a6a', '#6a6a8a']
            },
            skeleton: {
                body: [
                    [0,1,1,1,0],
                    [1,2,2,2,1],
                    [0,1,2,1,0],
                    [0,1,1,1,0],
                    [0,1,0,1,0]
                ],
                colors: ['#000000', '#c0c0c0', '#ffffff']
            },
            zombie: {
                body: [
                    [0,1,1,1,0],
                    [1,2,2,2,1],
                    [1,2,3,2,1],
                    [0,1,1,1,0],
                    [1,0,1,0,1]
                ],
                colors: ['#000000', '#2d5a27', '#4a7a3a']
            },
            chest: {
                body: [
                    [1,1,1,1,1],
                    [1,2,2,2,1],
                    [1,2,3,2,1],
                    [1,2,2,2,1],
                    [1,1,1,1,1]
                ],
                colors: ['#000000', '#8b0000', '#daa520']
            },
            mimic: {
                body: [
                    [1,1,1,1,1],
                    [1,2,3,2,1],
                    [1,2,2,2,1],
                    [1,2,2,2,1],
                    [1,1,1,1,1]
                ],
                colors: ['#000000', '#dc143c', '#ff0000']
            }
        };

        // Desenhar sprite pixel art
        function drawSprite(sprite, x, y, size = 20) {
            const pixelSize = size / 5;
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const colorIndex = sprite.body[row][col];
                    if (colorIndex > 0) {
                        ctx.fillStyle = sprite.colors[colorIndex];
                        ctx.fillRect(
                            x + col * pixelSize - size/2,
                            y + row * pixelSize - size/2,
                            pixelSize,
                            pixelSize
                        );
                    }
                }
            }
        }

        // Expanded equipment types
        const weaponTypes = [
            { name: 'Short Sword', damage: [8, 12], rarity: 'common', type: 'weapon', slot: 'weapon' },
            { name: 'Long Sword', damage: [12, 18], rarity: 'uncommon', type: 'weapon', slot: 'weapon' },
            { name: 'Battle Axe', damage: [15, 22], rarity: 'rare', type: 'weapon', slot: 'weapon' },
            { name: 'Dark Blade', damage: [20, 30], rarity: 'epic', type: 'weapon', slot: 'weapon' },
            { name: 'Kings Sword', damage: [25, 40], rarity: 'legendary', type: 'weapon', slot: 'weapon' }
        ];

        const armorTypes = [
            { name: 'Leather Armor', defense: 3, rarity: 'common', type: 'armor', slot: 'armor' },
            { name: 'Chain Mail', defense: 6, rarity: 'uncommon', type: 'armor', slot: 'armor' },
            { name: 'Plate Armor', defense: 10, rarity: 'rare', type: 'armor', slot: 'armor' },
            { name: 'Dragon Armor', defense: 15, rarity: 'epic', type: 'armor', slot: 'armor' },
            { name: 'Godly Plate', defense: 25, rarity: 'legendary', type: 'armor', slot: 'armor' }
        ];

        const helmetTypes = [
            { name: 'Leather Cap', defense: 1, rarity: 'common', type: 'helmet', slot: 'helmet' },
            { name: 'Iron Helm', defense: 2, rarity: 'uncommon', type: 'helmet', slot: 'helmet' },
            { name: 'Steel Helm', defense: 3, rarity: 'rare', type: 'helmet', slot: 'helmet' },
            { name: 'Dragon Helm', defense: 5, rarity: 'epic', type: 'helmet', slot: 'helmet' },
            { name: 'Crown of Kings', defense: 8, rarity: 'legendary', type: 'helmet', slot: 'helmet' }
        ];

        const bootTypes = [
            { name: 'Leather Boots', speed: 1, rarity: 'common', type: 'boots', slot: 'boots' },
            { name: 'Iron Boots', speed: 1, defense: 1, rarity: 'uncommon', type: 'boots', slot: 'boots' },
            { name: 'Steel Boots', speed: 1, defense: 2, rarity: 'rare', type: 'boots', slot: 'boots' },
            { name: 'Dragon Boots', speed: 2, defense: 3, rarity: 'epic', type: 'boots', slot: 'boots' },
            { name: 'Boots of Speed', speed: 3, defense: 2, rarity: 'legendary', type: 'boots', slot: 'boots' }
        ];

        const ringTypes = [
            { name: 'Copper Ring', damage: [1, 2], rarity: 'common', type: 'ring', slot: 'ring' },
            { name: 'Silver Ring', damage: [2, 3], rarity: 'uncommon', type: 'ring', slot: 'ring' },
            { name: 'Gold Ring', damage: [3, 5], rarity: 'rare', type: 'ring', slot: 'ring' },
            { name: 'Ruby Ring', damage: [5, 8], rarity: 'epic', type: 'ring', slot: 'ring' },
            { name: 'Dragon Ring', damage: [8, 12], rarity: 'legendary', type: 'ring', slot: 'ring' }
        ];

        const amuletTypes = [
            { name: 'Bone Amulet', health: 10, rarity: 'common', type: 'amulet', slot: 'amulet' },
            { name: 'Silver Amulet', health: 20, rarity: 'uncommon', type: 'amulet', slot: 'amulet' },
            { name: 'Gold Amulet', health: 30, rarity: 'rare', type: 'amulet', slot: 'amulet' },
            { name: 'Ruby Amulet', health: 50, rarity: 'epic', type: 'amulet', slot: 'amulet' },
            { name: 'Amulet of Life', health: 100, rarity: 'legendary', type: 'amulet', slot: 'amulet' }
        ];

        // Input handling
        const keys = {};
        const mouse = { x: 0, y: 0, down: false };
        
        // Game engine
        const game = {
            loop: function() {
                if (gameState !== 'playing') return;
                
                this.update();
                this.render();
                requestAnimationFrame(() => this.loop());
            },
            
            update: function() {
                this.updatePlayer();
                this.updateEnemies();
                this.updateProjectiles();
                this.updateParticles();
                this.updateCombatTexts();
                this.checkCollisions();
                this.updateUI();
            },
            
            render: function() {
                // Clear canvas
                ctx.fillStyle = '#0a0a0f';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw room
                this.drawRoom();
                
                // Draw items
                items.forEach(item => {
                    if (item.type === 'chest' || item.type === 'mimic') {
                        drawSprite(item.sprite, item.x, item.y, 30);
                    } else {
                        // Draw simple pixel for other items
                        ctx.fillStyle = item.color;
                        ctx.fillRect(item.x - 5, item.y - 5, 10, 10);
                    }
                });
                
                // Draw enemies
                enemies.forEach(enemy => {
                    drawSprite(enemy.sprite, enemy.x, enemy.y, enemy.size);
                });
                
                // Draw player
                drawSprite(sprites.player, player.x, player.y, player.size);
                
                // Draw projectiles
                projectiles.forEach(projectile => {
                    ctx.fillStyle = projectile.color;
                    ctx.fillRect(projectile.x - 2, projectile.y - 2, 4, 4);
                });
            },
            
            drawRoom: function() {
                // Simple pixel room
                ctx.fillStyle = '#1a1a2e';
                ctx.fillRect(50, 50, canvas.width - 100, canvas.height - 100);
                
                ctx.strokeStyle = '#2d2d4d';
                ctx.lineWidth = 4;
                ctx.strokeRect(50, 50, canvas.width - 100, canvas.height - 100);
                
                // Draw pixel torches
                ctx.fillStyle = '#8b0000';
                ctx.fillRect(70, 70, 6, 6);
                ctx.fillRect(canvas.width - 76, 70, 6, 6);
                ctx.fillRect(70, canvas.height - 76, 6, 6);
                ctx.fillRect(canvas.width - 76, canvas.height - 76, 6, 6);
            },
            
            updatePlayer: function() {
                // Movement
                let moveX = 0, moveY = 0;
                
                if (keys['w'] || keys['ArrowUp']) moveY -= player.speed;
                if (keys['s'] || keys['ArrowDown']) moveY += player.speed;
                if (keys['a'] || keys['ArrowLeft']) moveX -= player.speed;
                if (keys['d'] || keys['ArrowRight']) moveX += player.speed;
                
                // Update position
                player.x += moveX;
                player.y += moveY;
                
                // Keep player in bounds
                player.x = Math.max(60, Math.min(canvas.width - 60, player.x));
                player.y = Math.max(60, Math.min(canvas.height - 60, player.y));
                
                // Update direction
                const dx = mouse.x - player.x;
                const dy = mouse.y - player.y;
                player.angle = Math.atan2(dy, dx);
                
                // Attack
                if (mouse.down && player.attackCooldown <= 0) {
                    this.playerAttack();
                }
                
                if (player.attackCooldown > 0) {
                    player.attackCooldown--;
                }
            },
            
            playerAttack: function() {
                const projectile = {
                    x: player.x,
                    y: player.y,
                    vx: Math.cos(player.angle) * 8,
                    vy: Math.sin(player.angle) * 8,
                    damage: this.calculatePlayerDamage(),
                    lifetime: 60,
                    color: '#daa520'
                };
                
                projectiles.push(projectile);
                player.attackCooldown = player.attackSpeed;
            },
            
            updateEnemies: function() {
                enemies.forEach((enemy, index) => {
                    if (enemy.health <= 0) {
                        // Drop loot
                        if (Math.random() < 0.3) {
                            this.spawnLoot(enemy.x, enemy.y);
                        }
                        enemies.splice(index, 1);
                        return;
                    }
                    
                    // Simple AI
                    const dx = player.x - enemy.x;
                    const dy = player.y - enemy.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 150) {
                        enemy.x += (dx / distance) * enemy.speed;
                        enemy.y += (dy / distance) * enemy.speed;
                    }
                });
            },
            
            updateProjectiles: function() {
                for (let i = projectiles.length - 1; i >= 0; i--) {
                    const projectile = projectiles[i];
                    projectile.x += projectile.vx;
                    projectile.y += projectile.vy;
                    projectile.lifetime--;
                    
                    if (projectile.lifetime <= 0) {
                        projectiles.splice(i, 1);
                    }
                }
            },
            
            updateParticles: function() {
                // Particle system would go here
            },
            
            updateCombatTexts: function() {
                // Combat text system would go here
            },
            
            checkCollisions: function() {
                // Projectile vs Enemy
                for (let i = projectiles.length - 1; i >= 0; i--) {
                    for (let j = enemies.length - 1; j >= 0; j--) {
                        const dx = projectiles[i].x - enemies[j].x;
                        const dy = projectiles[i].y - enemies[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 20) {
                            enemies[j].health -= projectiles[i].damage;
                            projectiles.splice(i, 1);
                            break;
                        }
                    }
                }
                
                // Player vs Items
                for (let i = items.length - 1; i >= 0; i--) {
                    const dx = player.x - items[i].x;
                    const dy = player.y - items[i].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 25) {
                        this.collectItem(items[i]);
                        items.splice(i, 1);
                    }
                }
            },
            
            collectItem: function(item) {
                if (item.type === 'chest') {
                    // Spawn multiple items from chest
                    for (let i = 0; i < 3; i++) {
                        this.spawnRandomItem(item.x, item.y);
                    }
                } else if (item.type === 'mimic') {
                    // Mimic attacks!
                    enemies.push(this.createEnemy('mimic', item.x, item.y));
                } else {
                    this.addToInventory(item);
                }
            },
            
            spawnLoot: function(x, y) {
                const lootTypes = ['weapon', 'armor', 'helmet', 'boots', 'ring', 'amulet'];
                const lootType = lootTypes[Math.floor(Math.random() * lootTypes.length)];
                this.spawnRandomItem(x, y, lootType);
            },
            
            spawnRandomItem: function(x, y, type = null) {
                if (!type) {
                    const types = ['weapon', 'armor', 'helmet', 'boots', 'ring', 'amulet', 'chest', 'mimic'];
                    type = types[Math.floor(Math.random() * types.length)];
                }
                
                let item;
                const rarityRoll = Math.random();
                let rarityIndex = 0;
                if (rarityRoll < 0.6) rarityIndex = 0;
                else if (rarityRoll < 0.85) rarityIndex = 1;
                else if (rarityRoll < 0.95) rarityIndex = 2;
                else if (rarityRoll < 0.99) rarityIndex = 3;
                else rarityIndex = 4;
                
                switch(type) {
                    case 'weapon':
                        item = {...weaponTypes[rarityIndex]};
                        break;
                    case 'armor':
                        item = {...armorTypes[rarityIndex]};
                        break;
                    case 'helmet':
                        item = {...helmetTypes[rarityIndex]};
                        break;
                    case 'boots':
                        item = {...bootTypes[rarityIndex]};
                        break;
                    case 'ring':
                        item = {...ringTypes[rarityIndex]};
                        break;
                    case 'amulet':
                        item = {...amuletTypes[rarityIndex]};
                        break;
                    case 'chest':
                        item = {
                            type: 'chest',
                            name: 'Treasure Chest',
                            sprite: sprites.chest,
                            color: '#daa520'
                        };
                        break;
                    case 'mimic':
                        item = {
                            type: 'mimic',
                            name: 'Mimic Chest',
                            sprite: sprites.mimic,
                            color: '#dc143c'
                        };
                        break;
                }
                
                item.x = x;
                item.y = y;
                items.push(item);
            },
            
            createEnemy: function(type, x, y) {
                const enemy = {
                    type: type,
                    x: x || Math.random() * (canvas.width - 100) + 50,
                    y: y || Math.random() * (canvas.height - 100) + 50,
                    health: 30,
                    maxHealth: 30,
                    damage: 5,
                    speed: 1,
                    size: 20,
                    sprite: sprites[type] || sprites.skeleton
                };
                return enemy;
            },
            
            calculatePlayerDamage: function() {
                let damage = player.damageMin + Math.random() * (player.damageMax - player.damageMin);
                if (player.equippedWeapon) {
                    damage += player.equippedWeapon.damage[0] + 
                             Math.random() * (player.equippedWeapon.damage[1] - player.equippedWeapon.damage[0]);
                }
                return Math.floor(damage);
            },
            
            addToInventory: function(item) {
                if (player.inventory.length < 16) {
                    player.inventory.push(item);
                    this.updateInventoryUI();
                }
            },
            
            updateInventoryUI: function() {
                const inventorySlots = document.getElementById('inventory-slots');
                inventorySlots.innerHTML = '';
                
                player.inventory.forEach((item, index) => {
                    const slot = document.createElement('div');
                    slot.className = 'inventory-slot';
                    slot.textContent = item.name.charAt(0);
                    slot.title = item.name;
                    
                    slot.addEventListener('click', (e) => {
                        if (e.altKey) {
                            // Delete item on Alt+Click
                            player.inventory.splice(index, 1);
                            this.updateInventoryUI();
                        } else {
                            this.equipItem(index);
                        }
                    });
                    
                    inventorySlots.appendChild(slot);
                });
                
                // Fill empty slots
                for (let i = player.inventory.length; i < 16; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'inventory-slot';
                    inventorySlots.appendChild(slot);
                }
            },
            
            equipItem: function(index) {
                const item = player.inventory[index];
                const slotType = item.slot;
                
                // Unequip current item in slot
                if (player['equipped' + slotType.charAt(0).toUpperCase() + slotType.slice(1)]) {
                    player.inventory.push(player['equipped' + slotType.charAt(0).toUpperCase() + slotType.slice(1)]);
                }
                
                // Equip new item
                player['equipped' + slotType.charAt(0).toUpperCase() + slotType.slice(1)] = item;
                player.inventory.splice(index, 1);
                
                // Update stats
                this.updatePlayerStats();
                this.updateInventoryUI();
                this.updateEquipmentUI();
            },
            
            updatePlayerStats: function() {
                // Recalculate player stats based on equipment
                player.defense = 5;
                player.speed = 4;
                
                if (player.equippedArmor) player.defense += player.equippedArmor.defense;
                if (player.equippedHelmet) player.defense += player.equippedHelmet.defense;
                if (player.equippedBoots) {
                    player.defense += (player.equippedBoots.defense || 0);
                    player.speed += (player.equippedBoots.speed || 0);
                }
                if (player.equippedRing) {
                    player.damageMin += player.equippedRing.damage[0];
                    player.damageMax += player.equippedRing.damage[1];
                }
                if (player.equippedAmulet) {
                    player.maxHealth += player.equippedAmulet.health;
                }
            },
            
            updateEquipmentUI: function() {
                const slots = ['weapon', 'armor', 'helmet', 'boots', 'ring', 'amulet'];
                slots.forEach(slot => {
                    const equipped = player['equipped' + slot.charAt(0).toUpperCase() + slot.slice(1)];
                    document.getElementById('equipped-' + slot).textContent = equipped ? equipped.name : '-';
                });
            },
            
            updateUI: function() {
                document.getElementById('health-fill').style.width = (player.health / player.maxHealth * 100) + '%';
                document.getElementById('mana-fill').style.width = (player.mana / player.maxMana * 100) + '%';
                document.getElementById('player-level').textContent = player.level;
                document.getElementById('player-damage').textContent = player.damageMin + '-' + player.damageMax;
                document.getElementById('player-defense').textContent = player.defense;
                document.getElementById('player-gold').textContent = player.gold;
            },
            
            initGame: function() {
                // Reset game state
                player = {
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    size: 20,
                    speed: 4,
                    health: 100,
                    maxHealth: 100,
                    mana: 100,
                    maxMana: 100,
                    damageMin: 8,
                    damageMax: 12,
                    defense: 5,
                    level: 1,
                    gold: 0,
                    attackCooldown: 0,
                    attackSpeed: 20,
                    inventory: [],
                    equippedWeapon: null,
                    equippedArmor: null,
                    equippedHelmet: null,
                    equippedBoots: null,
                    equippedRing: null,
                    equippedAmulet: null
                };
                
                enemies = [
                    this.createEnemy('skeleton'),
                    this.createEnemy('zombie')
                ];
                
                items = [
                    { type: 'chest', x: 200, y: 200, name: 'Treasure Chest', sprite: sprites.chest, color: '#daa520' }
                ];
                
                projectiles = [];
                
                this.updateInventoryUI();
                this.updateEquipmentUI();
                this.loop();
            }
        };

        // Event Listeners
        window.addEventListener('load', function() {
            // Mouse events
            canvas.addEventListener('mousemove', function(e) {
                const rect = canvas.getBoundingClientRect();
                mouse.x = (e.clientX - rect.left) * (canvas.width / rect.width);
                mouse.y = (e.clientY - rect.top) * (canvas.height / rect.height);
            });
            
            canvas.addEventListener('mousedown', function() {
                mouse.down = true;
            });
            
            canvas.addEventListener('mouseup', function() {
                mouse.down = false;
            });
            
            // Keyboard events
            window.addEventListener('keydown', function(e) {
                keys[e.key] = true;
            });
            
            window.addEventListener('keyup', function(e) {
                keys[e.key] = false;
            });
            
            // UI events
            document.getElementById('start-btn').addEventListener('click', function() {
                document.querySelector('.start-screen').style.display = 'none';
                gameState = 'playing';
                game.initGame();
            });
            
            document.getElementById('restart-btn').addEventListener('click', function() {
                document.querySelector('.game-over').style.display = 'none';
                gameState = 'playing';
                game.initGame();
            });
            
            // Create initial inventory slots
            const inventorySlots = document.getElementById('inventory-slots');
            for (let i = 0; i < 16; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                inventorySlots.appendChild(slot);
            }
        });
    </script>
</body>
</html>
